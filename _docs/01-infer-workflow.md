---
id: infer-workflow
title: Infer 的工作机制
layout: docs
permalink: /docs/infer-workflow.html
section: User Guide
section_order: 01
order: 01
---

本页文档说明 Infer 的几种运行方式，你可根据你自己的项目具体情况选用。

**摘要**

1. 初次运行时，确保项目是清理过的。可以通过 (`make clean`，`gradle clean`
等等)
2. 两次运行之间，记得清理项目，或者通过 `--incremental`
选项，方式因为增量编译而无结果输出。
3. 如果你使用的是非增量编译系统，则无需如此，比如：`infer -- javac Hello.java`，编译 Java 文件。
4. 成功运行之后，在同一目录下，你可以通过 `inferTraceBugs` 浏览更加详细的报告。

## Infer 运行的两个阶段

不管是哪种语言，Infer 运行时，分为两个主要阶段：

### 1. 捕获阶段

Infer 捕获编译命令，将文件翻译成 Infer 内部的中间语言。

这种翻译和编译类似，Infer 从编译过程获取信息，并进行翻译。这就是我们调用 Infer
时带上一个编译命令的原因了，比如: `infer -- clang -c file.c`, `infer -- javac
File.java`。结果就是文件照常编译，同时被 Infer
翻译成中间语言，留作第二阶段处理。特别注意的就是，如果没有文件被编译，那么也没有任何文件会被分析。

Infer 把中间文件存储在结果文件夹中，一般来说，这个文件夹会在运行 `infer`
的目录下创建，命名是 `infer-out/`。当然，你也可以通过 `-o`
选项来自定义文件夹名字：

```bash
infer -o /tmp/out -- javac Test.java
```

### 2. 分析阶段

In this phase, the files in `infer-out/` are analyzed by Infer.  Infer
analyzes each function and method separately. If Infer encounters an
error when analyzing a method or function, it stops there for that
method or function, but will continue the analysis of other methods
and functions. So, a possible workflow would be to run Infer on your
code, fix the errors generated, and run it again to find possibly more
errors or to check that all the errors have been fixed.

The errors will be displayed in the standard output and also in a file
`infer-out/bugs.txt`. We filter the bugs and show the ones that are
most likely to be real. In the results directory (`infer-out/`),
however, we also save a file `report.csv` that contains all the
errors, warnings and infos reported by Infer in csv format.


## Incremental and non-incremental workflows

By default, running Infer will delete the previous `infer-out/`
directory if it exists. This leads to a *non-incremental*
workflow. Passing `--incremental` (or `-i`) to Infer prevents it from
deleting `infer-out/`, leading to an *incremental* workflow.

There are exceptions to this. In particular, you can run only one of
the phases above. For instance, `infer -- javac Hello.java` is
equivalent to running these two commands:

```bash
infer -a capture -- javac Hello.java
infer -- analyze
```

Notice that the second command does not erase `infer-out/`, as the
files it needs to analyze live there!

You can learn more about the various modes of operations of Infer by
running `infer --help`.

Let us highlight when you may need non-incremental and incremental
workflows.


### Non-incremental workflow

Non-incremental workflow is well suited to running Infer repeatedly
with a single compiler command, e.g.

```bash
infer -- javac Hello.java
edit Hello.java
# make some changes to Hello.java, e.g. fix a bug reported by Infer
infer -- javac Hello.java
```

To start a fresh analysis, you have to

1. delete the results directory:

    ```bash
    rm -fr infer-out
    ```

2. clean the build products, for instance with `make clean` for a make-based project.


### Incremental workflow

Software projects such as mobile apps use *incremental* build systems.
Infer understands several such build systems, detailed in the [next
section](docs/analyzing-apps-or-projects.html). To analyze your
project using Infer, it has to use one of these build systems.

Running Infer on your project is as simple as running `infer -- <your
build command here>` where the build command is the one you would
normally use to compile your source code. Infer should be first run on
a *clean* version of the project, to capture all the compilation
commands in its capture phase.

For instance, for a project compiled using gradle,

```bash
gradle clean
infer -- gradle build
```

Next, if you change some files in your project, for instance in
response to an Infer report, you can either repeat the commands above,
that is clean and reanalyze the entire project, or else tell Infer
that you are using an incremental toolchain:

```bash
edit some/File.java
# make some changes to some/File.java
infer --incremental -- gradle build
```

Note that you can run Infer with the `--incremental` flag the first
time around as well.


## Exploring Infer reports

You can get more information about the reports generated by Infer by
running `inferTraceBugs` in the same directory. For instance

```bash
infer -- gradle build
inferTraceBugs
```

This tool allows you to see error traces leading to each bug reported
by Infer, which can be helpful in tracking down the precise cause of
each bug. See the output of `inferTraceBugs --help` for more
information.
